repeat task.wait() until game:IsLoaded()
repeat task.wait() until game.Players
repeat task.wait() until game.Players.LocalPlayer
repeat task.wait() until game.Players.LocalPlayer:FindFirstChild("PlayerGui")

local player = game.Players.LocalPlayer
local stats = player:WaitForChild("Data")
local level = stats:WaitForChild("Level")
local points = stats:WaitForChild("Points")
local humanoid = player.Character:WaitForChild("Humanoid")
local flying = true -- Bật bay tự động

-- Hàm chọn phe hải tặc
local function selectPirate()
    local team = game:GetService("Teams"):FindFirstChild("Pirate")
    if team then
        player.Team = team
    end
end

-- Hàm để bật bay
local function toggleFly()
    humanoid.PlatformStand = true -- Ngăn cản rơi
    local flySpeed = 200 -- Tốc độ bay 200m/s

    while flying do
        task.wait(0.1) -- Cập nhật vị trí mỗi 0.1 giây
        local direction = Vector3.new(0, 0, 0)

        -- Di chuyển nhân vật
        player.Character.HumanoidRootPart.Velocity = direction.Unit * flySpeed
    end
end

-- Hàm tự động cộng điểm cho Melee
local function autoAssignPoints()
    while task.wait(5) do
        if points.Value > 0 then
            game:GetService("ReplicatedStorage").Remotes["AddPoint"]:InvokeServer("Melee", points.Value)
        end
    end
end

-- Hàm tìm NPC và nhiệm vụ dựa trên level hiện tại
local function getQuestNPC()
    local questNPCs = {
        {levelRange = {1, 10}, npc = "Starter NPC", enemy = "Bandit"},
        {levelRange = {10, 20}, npc = "Pirate NPC", enemy = "Pirate"},
        {levelRange = {20, 30}, npc = "Marine NPC", enemy = "Marine"},
        -- Thêm các NPC và mức độ tương ứng
        {levelRange = {690, 700}, npc = "Final Boss", enemy = "BossEnemy"},
    }

    for _, quest in pairs(questNPCs) do
        if level.Value >= quest.levelRange[1] and level.Value <= quest.levelRange[2] then
            return quest
        end
    end
    return nil
end

-- Hàm tự động nhận nhiệm vụ và cày quái
local function autoFarm()
    while task.wait(1) do
        local currentQuest = getQuestNPC()

        if currentQuest and not player.PlayerGui.Main.Quest.Visible then
            -- Nhận nhiệm vụ
            local questNPC = game:GetService("Workspace").NPCs:FindFirstChild(currentQuest.npc)
            if questNPC then
                game:GetService("ReplicatedStorage").Remotes["Quest"]:InvokeServer(questNPC.Name)
            end
        elseif currentQuest then
            -- Tìm và tiêu diệt quái
            for _, enemy in pairs(game:GetService("Workspace").Enemies:GetChildren()) do
                if enemy.Name == currentQuest.enemy and enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 then
                    -- Di chuyển đến quái và đứng trên đầu quái
                    local enemyPos = enemy.HumanoidRootPart.Position
                    local standPosition = enemyPos + Vector3.new(0, 3, 0) -- Đứng trên đầu quái
                    humanoid:MoveTo(standPosition)
                    task.wait(1) -- Chờ cho đến khi đến vị trí

                    -- Tấn công quái
                    game:GetService("ReplicatedStorage").Remotes["MeleeAttack"]:InvokeServer(enemy)
                end
            end
        end

        -- Kiểm tra level để chuyển sang Sea 2
        if level.Value >= 700 then
            moveToSecondSea()
            break
        end
    end
end

-- Hàm tự động chuyển qua Sea 2
local function moveToSecondSea()
    local secondSeaNPC = game:GetService("Workspace").NPCs:FindFirstChild("Military Detective") -- Tên NPC chuyển Sea
    if secondSeaNPC then
        humanoid:MoveTo(secondSeaNPC.HumanoidRootPart.Position)
        task.wait(5)
        game:GetService("ReplicatedStorage").Remotes["Dialogue"]:InvokeServer(secondSeaNPC)
        print("Đã chuyển qua Sea 2")
    end
end

-- Khởi động script
selectPirate()
toggleFly() -- Bật bay tự động
spawn(autoAssignPoints)
spawn(autoFarm)
